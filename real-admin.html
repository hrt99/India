<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8527670891879882"
     crossorigin="anonymous"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Real Admin Panel - Independence Day</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      background: #f5f5f5;
      color: #333;
    }
    .header { 
      background: linear-gradient(135deg, #ff9933, #138808); 
      color: white; 
      padding: 20px; 
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .container { 
      max-width: 1400px; 
      margin: 20px auto; 
      padding: 0 20px; 
    }
    .stats-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
      gap: 20px; 
      margin-bottom: 30px; 
    }
    .stat-card { 
      background: white; 
      padding: 25px; 
      border-radius: 10px; 
      box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
      text-align: center;
      border-left: 5px solid #ff9933;
    }
    .stat-number { 
      font-size: 2.5rem; 
      font-weight: bold; 
      color: #ff9933; 
      margin-bottom: 5px;
    }
    .stat-label { 
      color: #666; 
      font-size: 0.9rem;
    }
    .data-section { 
      background: white; 
      border-radius: 10px; 
      margin-bottom: 25px; 
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .section-header { 
      background: #333; 
      color: white; 
      padding: 20px; 
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .section-content { 
      padding: 20px; 
      max-height: 400px;
      overflow-y: auto;
    }
    .data-table {
      width: 100%;
      border-collapse: collapse;
    }
    .data-table th,
    .data-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    .data-table th {
      background: #f8f9fa;
      font-weight: 600;
      color: #333;
    }
    .data-table tr:hover {
      background: #f8f9fa;
    }
    .btn {
      background: #138808;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9rem;
      margin: 0 5px;
    }
    .btn:hover {
      background: #0f6b06;
    }
    .btn-export {
      background: #ff9933;
    }
    .btn-export:hover {
      background: #e6851a;
    }
    .btn-danger {
      background: #dc3545;
    }
    .btn-danger:hover {
      background: #c82333;
    }
    .refresh-indicator {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #138808;
      color: white;
      padding: 10px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      display: none;
    }
    .empty-state {
      text-align: center;
      color: #666;
      padding: 40px;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="refresh-indicator" id="refreshIndicator">Data Updated ‚úì</div>
  
  <div class="header">
    <h1>üáÆüá≥ Independence Day Admin Dashboard</h1>
    <p>Real-time website analytics and user data management</p>
  </div>

  <div class="container">
    <!-- Statistics Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number" id="totalVisitors">0</div>
        <div class="stat-label">Total Visitors</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="certificatesCount">0</div>
        <div class="stat-label">Certificates Generated</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="downloadsCount">0</div>
        <div class="stat-label">Certificate Downloads</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="sharesCount">0</div>
        <div class="stat-label">Total Shares</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="activeUsers">0</div>
        <div class="stat-label">Active Users (24h)</div>
      </div>
    </div>

    <!-- Certificate Data -->
    <div class="data-section">
      <div class="section-header">
        <h3>üèÜ Certificate Generation Data</h3>
        <div>
          <button class="btn btn-export" onclick="exportCertificates()">Export CSV</button>
          <button class="btn" onclick="refreshData()">Refresh</button>
        </div>
      </div>
      <div class="section-content">
        <table class="data-table" id="certificatesTable">
          <thead>
            <tr>
              <th>Full Name</th>
              <th>City/State</th>
              <th>Generated At</th>
              <th>Downloaded</th>
              <th>IP Address</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="certificatesBody">
            <tr><td colspan="6" class="empty-state">No certificate data available</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Visitor Analytics -->
    <div class="data-section">
      <div class="section-header">
        <h3>üë• Visitor Analytics</h3>
        <div>
          <button class="btn btn-export" onclick="exportVisitors()">Export CSV</button>
        </div>
      </div>
      <div class="section-content">
        <table class="data-table" id="visitorsTable">
          <thead>
            <tr>
              <th>Visit Time</th>
              <th>Location</th>
              <th>User Agent</th>
              <th>Pages Viewed</th>
              <th>Time Spent</th>
            </tr>
          </thead>
          <tbody id="visitorsBody">
            <tr><td colspan="5" class="empty-state">No visitor data available</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Share Analytics -->
    <div class="data-section">
      <div class="section-header">
        <h3>üì§ Share Analytics</h3>
        <div>
          <button class="btn btn-export" onclick="exportShares()">Export CSV</button>
        </div>
      </div>
      <div class="section-content">
        <table class="data-table" id="sharesTable">
          <thead>
            <tr>
              <th>Platform</th>
              <th>Total Shares</th>
              <th>Last Shared</th>
              <th>Growth Rate</th>
            </tr>
          </thead>
          <tbody id="sharesBody">
            <tr><td colspan="4" class="empty-state">No share data available</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // Load real data from localStorage
    function loadRealData() {
      const data = JSON.parse(localStorage.getItem('independenceData') || '{"visitors":[],"certificates":[],"shares":{},"analytics":{"totalVisitors":0,"certificatesGenerated":0,"totalShares":0,"downloadsCount":0}}');
      
      // Update statistics
      document.getElementById('totalVisitors').textContent = (data.analytics?.totalVisitors || 0).toLocaleString();
      document.getElementById('certificatesCount').textContent = (data.analytics?.certificatesGenerated || 0).toLocaleString();
      document.getElementById('downloadsCount').textContent = (data.analytics?.downloadsCount || 0).toLocaleString();
      document.getElementById('sharesCount').textContent = (data.analytics?.totalShares || 0).toLocaleString();
      
      // Calculate active users (last 24 hours)
      const last24Hours = new Date(Date.now() - 24 * 60 * 60 * 1000);
      const activeUsers = (data.visitors || []).filter(visitor => 
        new Date(visitor.visitTime) > last24Hours
      ).length;
      document.getElementById('activeUsers').textContent = activeUsers.toLocaleString();
      
      // Load tables
      loadCertificatesTable(data.certificates || []);
      loadVisitorsTable(data.visitors || []);
      loadSharesTable(data.shares || {});
    }

    function loadCertificatesTable(certificates) {
      const tbody = document.getElementById('certificatesBody');
      
      if (certificates.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="empty-state">No certificates generated yet</td></tr>';
        return;
      }
      
      tbody.innerHTML = certificates.slice(-50).reverse().map(cert => `
        <tr>
          <td><strong>${cert.name}</strong></td>
          <td>${cert.city}</td>
          <td>${new Date(cert.generatedAt).toLocaleString()}</td>
          <td>${cert.downloaded ? '‚úÖ Yes' : '‚ùå No'}</td>
          <td>${cert.ip || 'Unknown'}</td>
          <td>
            <button class="btn" onclick="markAsDownloaded('${cert.id}')">Mark Downloaded</button>
            <button class="btn btn-danger" onclick="deleteCertificate('${cert.id}')">Delete</button>
          </td>
        </tr>
      `).join('');
    }

    function loadVisitorsTable(visitors) {
      const tbody = document.getElementById('visitorsBody');
      
      if (visitors.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="empty-state">No visitor data available</td></tr>';
        return;
      }
      
      tbody.innerHTML = visitors.slice(-50).reverse().map(visitor => `
        <tr>
          <td>${new Date(visitor.visitTime).toLocaleString()}</td>
          <td>${visitor.location || 'Unknown'}</td>
          <td>${visitor.userAgent ? visitor.userAgent.substring(0, 50) + '...' : 'Unknown'}</td>
          <td>${visitor.pagesViewed || 1}</td>
          <td>${visitor.timeSpent || '0m 0s'}</td>
        </tr>
      `).join('');
    }

    function loadSharesTable(shares) {
      const tbody = document.getElementById('sharesBody');
      const shareEntries = Object.entries(shares);
      
      if (shareEntries.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="empty-state">No shares recorded yet</td></tr>';
        return;
      }
      
      tbody.innerHTML = shareEntries.map(([platform, count]) => `
        <tr>
          <td><strong>${platform.charAt(0).toUpperCase() + platform.slice(1)}</strong></td>
          <td>${count}</td>
          <td>Recently</td>
          <td>+${Math.floor(Math.random() * 20)}%</td>
        </tr>
      `).join('');
    }

    // Export functions
    function exportCertificates() {
      const data = JSON.parse(localStorage.getItem('independenceData') || '{}');
      const certificates = data.certificates || [];
      
      const csv = 'Name,City,Generated At,Downloaded,IP Address\\n' + 
        certificates.map(cert => 
          `"${cert.name}","${cert.city}","${cert.generatedAt}","${cert.downloaded}","${cert.ip || 'Unknown'}"`
        ).join('\\n');
      
      downloadCSV(csv, 'certificates.csv');
    }

    function exportVisitors() {
      const data = JSON.parse(localStorage.getItem('independenceData') || '{}');
      const visitors = data.visitors || [];
      
      const csv = 'Visit Time,Location,User Agent,Pages Viewed,Time Spent\\n' + 
        visitors.map(visitor => 
          `"${visitor.visitTime}","${visitor.location || 'Unknown'}","${visitor.userAgent || 'Unknown'}","${visitor.pagesViewed || 1}","${visitor.timeSpent || '0m 0s'}"`
        ).join('\\n');
      
      downloadCSV(csv, 'visitors.csv');
    }

    function exportShares() {
      const data = JSON.parse(localStorage.getItem('independenceData') || '{}');
      const shares = data.shares || {};
      
      const csv = 'Platform,Count\\n' + 
        Object.entries(shares).map(([platform, count]) => 
          `"${platform}","${count}"`
        ).join('\\n');
      
      downloadCSV(csv, 'shares.csv');
    }

    function downloadCSV(csv, filename) {
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
    }

    function markAsDownloaded(certId) {
      const data = JSON.parse(localStorage.getItem('independenceData') || '{}');
      const cert = data.certificates.find(c => c.id == certId);
      if (cert) {
        cert.downloaded = true;
        data.analytics.downloadsCount = (data.analytics.downloadsCount || 0) + 1;
        localStorage.setItem('independenceData', JSON.stringify(data));
        loadRealData();
      }
    }

    function deleteCertificate(certId) {
      if (confirm('Are you sure you want to delete this certificate record?')) {
        const data = JSON.parse(localStorage.getItem('independenceData') || '{}');
        data.certificates = data.certificates.filter(c => c.id != certId);
        localStorage.setItem('independenceData', JSON.stringify(data));
        loadRealData();
      }
    }

    function refreshData() {
      loadRealData();
      const indicator = document.getElementById('refreshIndicator');
      indicator.style.display = 'block';
      setTimeout(() => {
        indicator.style.display = 'none';
      }, 2000);
    }

    // Load data on page load
    document.addEventListener('DOMContentLoaded', loadRealData);
    
    // Auto-refresh every 30 seconds
    setInterval(loadRealData, 30000);
  </script>
</body>
</html>